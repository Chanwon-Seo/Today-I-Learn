# 스프링 활용

## 시작 전 환경 설정

### application.yml

```yml
spring:
  datasource:
    url: jdbc:h2:tcp://localhost/~/jpashop;
    username: sa
    password:
    driver-class-name: org.h2.Driver

  jpa:
    hibernate:
      ddl-auto: create
    properties:
      hibernate:
        #        show_sql: true
        format_sql: true

logging.level:
  org.hibernate.SQL: debug
# org.hibernate.type: trace
```

### Member.class

```java
@Entity
@Getter //Lombok 사용
@Setter //Lombok 사용
public class Member {

    @Id
    @GeneratedValue
    private Long id;
    private String username;
}

```

### MemberRepository.class

```java
@Repository
public class MemberRepository {

    @PersistenceContext
    private EntityManager em;

    public Long save(Member member) {
        em.persist(member);
        return member.getId();
    }

    public Member find(Long id) {
        return em.find(Member.class, id);
    }
}
```

### MemberRepositoryTest.class

```java
@RunWith(SpringRunner.class)
@SpringBootTest
public class MemberRepositoryTest {

    @Autowired
    MemberRepository memberRepository;

    @Test
    @Transactional //테스트 코드에서 해당 어노테이션 설정 시 실제 DB에 값이 저장되지 않음. Rollback 되기 때문이다.
    @Rollback(false) //실제 DB에 데이터를 저장하고 싶다면 FALSE를 설정하여 데이터를 남긴다.
    public void testMember() throws Exception {
        //given
        Member member = new Member();
        member.setUsername("memberA");

        //when
        Long saveId = memberRepository.save(member);
        Member findMember = memberRepository.find(saveId);

        //then
        Assertions.assertThat(findMember.getId()).isEqualTo(member.getId());
        Assertions.assertThat(findMember.getUsername()).isEqualTo(member.getUsername());
        Assertions.assertThat(findMember).isEqualTo(member);
        System.out.println(findMember == member); // TRUE

    }
}
```

> findMember와 member의 비교에 TRUE가 나오는 이유?
>
> > 같은 트랜젝션(1차 캐시)안에서 저장과 조회를 하기 때문에 같은 엔티티로 식별되어야 한다.

---

# 참고

- [자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic/lecture/21683?tab=curriculum&volume=1.00&quality=auto)
